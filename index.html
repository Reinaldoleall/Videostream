<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MarketPlace Premium</title>

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="style.css">

    <!-- Firebase Scripts (Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
</head>

<body>

    <!-- Loading Overlay -->
    <div id="global-loading"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); z-index:9999; align-items:center; justify-content:center; flex-direction:column;">
        <div class="spinner"
            style="width:40px; height:40px; border:4px solid #f3f3f3; border-top:4px solid #2E7D32; border-radius:50%; animation:spin 1s linear infinite;">
        </div>
        <p id="loading-text" style="margin-top:15px; font-weight:500;">Carregando...</p>
        <style>
            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }

                100% {
                    transform: rotate(360deg);
                }
            }
        </style>
    </div>

    <!-- Header -->
    <header>
        <div class="container header-content">
            <a href="#" class="logo" onclick="showPage('home'); return false;">
                <i class="fas fa-store"></i>
                <span>MarketPlace</span>
            </a>
            <div class="user-info">
                <span id="user-greeting" class="user-name-span">Visitante</span>
                <div class="user-avatar" id="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="main-nav">
        <ul class="nav-list">
            <li><a href="#" id="nav-home" class="active"><i class="fas fa-home"></i> Início</a></li>
            <li><a href="#" id="nav-products"><i class="fas fa-box"></i> Produtos</a></li>
            <li><a href="#" id="nav-stores"><i class="fas fa-store"></i> Lojas</a></li>
            <li><a href="#" id="nav-my-store"><i class="fas fa-store-alt"></i> Minha Loja</a></li>
            <li><a href="#" id="nav-add-product"><i class="fas fa-plus-circle"></i> Vender</a></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="container">

        <!-- Alerts -->
        <div id="global-alert" class="alert hidden"></div>

        <!-- Login Page -->
        <div id="login-page" class="page">
            <div class="card" style="max-width: 400px; margin: 40px auto;">
                <h2 class="page-title" style="justify-content: center;"><i class="fas fa-sign-in-alt"></i> Entrar</h2>
                <div id="login-alert" class="alert hidden"></div>
                <form id="login-form">
                    <div class="form-group">
                        <label>E-mail</label>
                        <input type="email" id="login-email" class="form-control" placeholder="seu@email.com" required>
                    </div>
                    <div class="form-group">
                        <label>Senha</label>
                        <input type="password" id="login-password" class="form-control" placeholder="******" required>
                    </div>
                    <button type="submit" class="btn">Entrar</button>
                    <button type="button" id="show-register" class="btn btn-secondary">Criar Nova Conta</button>
                </form>
            </div>
        </div>

        <!-- Register Page -->
        <div id="register-page" class="page">
            <div class="card" style="max-width: 400px; margin: 40px auto;">
                <h2 class="page-title" style="justify-content: center;"><i class="fas fa-user-plus"></i> Cadastro</h2>
                <div id="register-alert" class="alert hidden"></div>
                <form id="register-form">
                    <div class="form-group">
                        <label>Nome Completo</label>
                        <input type="text" id="register-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>E-mail</label>
                        <input type="email" id="register-email" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Senha</label>
                        <input type="password" id="register-password" class="form-control" required minlength="6">
                    </div>
                    <button type="submit" class="btn">Cadastrar</button>
                    <button type="button" id="show-login" class="btn btn-secondary">Já tenho conta</button>
                </form>
            </div>
        </div>

        <!-- Home Page -->
        <div id="home-page" class="page active">
            <h2 class="page-title">Destaques</h2>
            <div id="featured-products" class="products-grid">
                <!-- Skeletons injected by JS -->
            </div>
        </div>

        <!-- Products Page -->
        <div id="products-page" class="page">
            <h2 class="page-title">Todos os Produtos</h2>
            <div class="search-container" style="position:relative; margin-bottom:20px;">
                <div class="input-wrapper" style="position:relative;">
                    <i class="fas fa-search"
                        style="position:absolute; left:15px; top:50%; transform:translateY(-50%); color:#aaa;"></i>
                    <input type="text" id="search-products" class="form-control" placeholder="O que você procura hoje?"
                        style="padding-left: 40px; border-radius: 25px; border: 1px solid #ddd; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
                </div>
                <div id="search-suggestions" class="search-suggestions hidden"></div>
            </div>

            <div id="filter-scroll-container" class="filter-chips-container"
                style="margin-bottom: 25px; overflow-x: auto; white-space: nowrap; padding-bottom: 5px; -webkit-overflow-scrolling: touch; cursor: grab;">
                <button class="chip active" onclick="filterByCategory('all')">Todos</button>
                <button class="chip" onclick="filterByCategory('Roupas')">Roupas</button>
                <button class="chip" onclick="filterByCategory('Eletrônicos')">Eletrônicos</button>
                <button class="chip" onclick="filterByCategory('Casa')">Casa</button>
                <button class="chip" onclick="filterByCategory('Beleza')">Beleza</button>
                <button class="chip" onclick="filterByCategory('Esportes')">Esportes</button>
                <button class="chip" onclick="filterByCategory('Brinquedos')">Brinquedos</button>
                <button class="chip" onclick="filterByCategory('Livros')">Livros</button>
                <button class="chip" onclick="filterByCategory('Automotivo')">Automotivo</button>
                <button class="chip" onclick="filterByCategory('Pet Shop')">Pet Shop</button>
                <button class="chip" onclick="filterByCategory('Games')">Games</button>
                <button class="chip" onclick="filterByCategory('Comidas')">Comidas</button>
                <button class="chip" onclick="filterByCategory('Doces')">Doces</button>
                <button class="chip" onclick="filterByCategory('Bebidas')">Bebidas</button>
            </div>
            <div id="products-list" class="products-grid"></div>
        </div>

        <!-- Stores Page -->
        <div id="stores-page" class="page">
            <h2 class="page-title">Lojas Parceiras</h2>
            <div id="stores-list"></div>
        </div>

        <!-- Store Profile Page (Public View) -->
        <div id="store-profile-page" class="page">
            <div id="store-profile-header" class="card"
                style="text-align:center; padding: 40px 20px; background: linear-gradient(to bottom, #fff, #f8f9fa);">
                <!-- Injected via JS -->
            </div>
            <h3 class="page-title" style="font-size:1.4rem; margin-top:0;">Produtos da Loja</h3>
            <div id="store-profile-products" class="products-grid"></div>
        </div>

        <!-- My Store Page -->
        <div id="my-store-page" class="page">
            <!-- Empty State -->
            <div id="store-not-created" class="card hidden">
                <div class="empty-state">
                    <i class="fas fa-store-slash"></i>
                    <h3>Sua loja ainda não existe</h3>
                    <p style="margin-bottom:20px;">Comece a vender hoje mesmo!</p>
                    <button id="create-store-btn" class="btn" style="max-width:200px; margin:0 auto;">
                        <i class="fas fa-plus"></i> Criar Loja
                    </button>
                </div>
            </div>

            <!-- Dashboard State -->
            <div id="store-created" class="hidden">
                <!-- Store Header Card -->
                <div class="card" style="display:flex; flex-direction:column; gap:20px; padding:24px;">
                    <div style="display:flex; align-items:center; gap:20px; flex-wrap:wrap;">
                        <img id="store-logo-img" src="" alt="Logo" class="store-avatar"
                            style="width:100px; height:100px; border-radius:50%; object-fit:cover; border:4px solid white; box-shadow:var(--shadow-md);">
                        <div style="flex:1;">
                            <h2 id="store-name" style="margin-bottom:8px; display:flex; align-items:center; gap:10px;">
                                Nome da Loja
                                <span
                                    style="font-size:0.8rem; background:#e8f5e9; color:var(--primary-color); padding:4px 8px; border-radius:12px;">Ativo</span>
                            </h2>
                            <p id="store-description" style="color:var(--text-muted); margin-bottom:12px;">Descrição da
                                loja...</p>
                            <p style="font-weight:500;"><i class="fab fa-whatsapp" style="color:#25D366"></i> <span
                                    id="store-phone"></span></p>
                        </div>
                        <button class="btn btn-secondary" onclick="openEditStoreModal()"
                            style="width:auto; height:fit-content; margin:0;">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                    </div>
                </div>

                <!-- Products Stats & List -->
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h3 class="page-title" style="margin:0;">Meus Produtos</h3>
                    <button id="add-product-from-store" class="btn btn-warning" onclick="showPage('add-product')"
                        style="width:auto; padding:10px 20px;">
                        <i class="fas fa-plus"></i> Novo
                    </button>
                </div>

                <div id="my-products-list" class="products-grid"></div>
            </div>
        </div>

        <!-- Add Product Page -->
        <div id="add-product-page" class="page">
            <h2 class="page-title">Novo Produto</h2>
            <div class="card">
                <form id="add-product-form">
                    <div class="form-group">
                        <label>Nome</label>
                        <input type="text" id="product-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Preço (R$)</label>
                        <input type="number" id="product-price" class="form-control" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Categoria</label>
                        <select id="product-category" class="form-control" required style="background:white;">
                            <option value="">Selecione...</option>
                            <option value="Roupas">Roupas</option>
                            <option value="Eletrônicos">Eletrônicos</option>
                            <option value="Casa">Casa</option>
                            <option value="Beleza">Beleza</option>
                            <option value="Esportes">Esportes</option>
                            <option value="Brinquedos">Brinquedos</option>
                            <option value="Livros">Livros</option>
                            <option value="Automotivo">Automotivo</option>
                            <option value="Pet Shop">Pet Shop</option>
                            <option value="Games">Games</option>
                            <option value="Comidas">Comidas</option>
                            <option value="Doces">Doces</option>
                            <option value="Bebidas">Bebidas</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Descrição</label>
                        <textarea id="product-description" class="form-control" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Fotos</label>
                        <input type="file" id="product-images" multiple accept="image/*" class="form-control">
                        <div id="image-preview" style="display:flex; gap:10px; margin-top:10px; overflow-x:auto;"></div>
                    </div>
                    <button type="submit" class="btn">Publicar</button>
                </form>
            </div>
        </div>

    </div>

    <!-- Store Modal (Create/Edit) -->
    <div id="store-modal" class="modal">
        <div class="modal-content">
            <div class="close-modal">&times;</div>
            <div style="padding:20px;">
                <h2>Dados da Loja</h2>
                <form id="store-form" style="margin-top:20px;">
                    <div class="form-group">
                        <label>Nome da Loja</label>
                        <input type="text" id="store-name-input" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Descrição</label>
                        <textarea id="store-description-input" class="form-control" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>WhatsApp (com DDD)</label>
                        <input type="tel" id="store-phone-input" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label>Logo</label>
                        <input type="file" id="store-logo" class="form-control">
                        <div id="store-logo-preview"></div>
                    </div>
                    <button type="submit" class="btn">Salvar</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Product Details Modal -->
    <div id="product-modal" class="modal">
        <div class="modal-content">
            <div class="close-modal">&times;</div>
            <div id="product-modal-content"></div>
        </div>
    </div>

    <!-- FAB -->
    <div class="fab" id="fab-add-product" onclick="showPage('add-product')">
        <i class="fas fa-plus"></i>
    </div>

    <!-- Logic -->
    <script src="script.js"></script>
</body>

</html>
